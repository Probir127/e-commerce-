{% extends 'store/base.html' %}
{% load static %}

{% block title %}My Profile - RB Trading{% endblock %}

{% block extra_css %}
<style>
    /* Profile Page Mobile Responsive Styles */
    @media (max-width: 768px) {
        .card-header {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 15px;
        }

        .card-header h5 {
            font-size: 18px;
        }

        .card-header .btn {
            width: 100%;
        }

        /* Stack user info vertically on mobile */
        .row.g-4 .col-md-4 {
            margin-bottom: 20px;
        }

        .h5 {
            font-size: 16px !important;
        }

        /* Make table more compact */
        .table {
            font-size: 13px;
        }

        .table th,
        .table td {
            padding: 8px 6px;
        }

        /* Hide less important columns on very small screens */
        @media (max-width: 480px) {

            .table th:nth-child(2),
            .table td:nth-child(2) {
                display: none;
            }
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="fw-bold text-primary mb-1">My Account</h2>
            <p class="text-muted">Manage your profile and view order history</p>
        </div>
    </div>

    <!-- User Info Card -->
    <div class="card border-0 shadow-sm mb-5">
        <div class="card-body p-4">
            <div class="row g-4">
                <div class="col-md-4">
                    <label class="text-uppercase text-muted fw-bold small mb-2">Username</label>
                    <p class="h5 text-dark mb-0">{{ user.username }}</p>
                </div>
                <div class="col-md-4">
                    <label class="text-uppercase text-muted fw-bold small mb-2">Email</label>
                    <p class="h5 text-dark mb-0">{{ user.email|default:"Not provided" }}</p>
                </div>
                <div class="col-md-4">
                    <label class="text-uppercase text-muted fw-bold small mb-2">Member Since</label>
                    <p class="h5 text-dark mb-0">{{ user.date_joined|date:"M d, Y" }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Order History Section -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-bottom py-3 d-flex justify-content-between align-items-center">
            <h5 class="mb-0 text-primary"><i class="fas fa-history me-2"></i>Order History</h5>
            {% if orders %}
            <button type="button" class="btn btn-outline-danger btn-sm rounded-pill" data-bs-toggle="modal"
                data-bs-target="#clearHistoryModal">
                <i class="fas fa-trash-alt me-1"></i> Clear History
            </button>
            {% endif %}
        </div>

        <div class="card-body p-0">
            {% if orders %}
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light text-secondary">
                        <tr>
                            <th class="ps-4">Order ID</th>
                            <th>Date</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Payment</th>
                            <th class="text-end pe-4">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in orders %}
                        <tr>
                            <td class="ps-4"><span class="fw-bold">#{{ order.id }}</span></td>
                            <td>{{ order.created_at|date:"M d, Y" }}</td>
                            <td class="fw-bold text-dark">Tk {{ order.total }}</td>
                            <td>
                                {% if order.status == 'pending' %}
                                <span class="badge bg-warning text-dark">Pending</span>
                                {% elif order.status == 'processing' %}
                                <span class="badge bg-info">Processing</span>
                                {% elif order.status == 'shipped' %}
                                <span class="badge bg-primary">Shipped</span>
                                {% elif order.status == 'delivered' %}
                                <span class="badge bg-success">Delivered</span>
                                {% elif order.status == 'cancelled' %}
                                <span class="badge bg-danger">Cancelled</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if order.payment_status == 'paid' %}
                                <span
                                    class="badge rounded-pill bg-success-subtle text-success border border-success px-3">Paid</span>
                                {% elif order.payment_status == 'pending' %}
                                <span
                                    class="badge rounded-pill bg-secondary-subtle text-secondary border border-secondary px-3">Unpaid</span>
                                {% elif order.payment_status == 'failed' %}
                                <span
                                    class="badge rounded-pill bg-danger-subtle text-danger border border-danger px-3">Failed</span>
                                {% endif %}
                            </td>
                            <td class="text-end pe-4">
                                <a href="{% url 'track_order' order.id %}" class="btn btn-sm btn-light border"
                                    title="Track Order">
                                    <i class="fas fa-map-marker-alt text-primary"></i> Track
                                </a>
                                {% if order.status == 'pending' or order.status == 'processing' %}
                                <a href="{% url 'cancel_order' order.id %}" class="btn btn-sm btn-outline-danger ms-1"
                                    onclick="return confirm('Are you sure you want to cancel this order?')"
                                    title="Cancel Order">
                                    <i class="fas fa-times"></i>
                                </a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5">
                <div class="mb-3">
                    <i class="fas fa-shopping-bag fa-3x text-muted opacity-50"></i>
                </div>
                <h5 class="text-muted fw-normal">No orders found</h5>
                <p class="text-muted small mb-4">You haven't placed any orders yet.</p>
                <a href="{% url 'index' %}" class="btn btn-primary px-4 rounded-pill">Start Shopping</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="clearHistoryModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Clear Order History?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to clear your order history?</p>
                <p class="text-muted small mb-0">This will only hide orders from your view. They will not be permanently
                    deleted from our system.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form action="{% url 'clear_history' %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Yes, Clear History</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}